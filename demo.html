<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DysAdapt - Démo Pleine Page</title>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            /* Empêche le scroll de la page principale */
            font-family: sans-serif;
        }

        :root {
            --blue-dys: #52B788;
            ;
        }

        /* CONTENEUR PLEINE PAGE */
        .dys-full-page-widget {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: #f0f0f0;
        }

        /* FOND : HTML ADAPTÉ */
        .layer-adapted-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .layer-adapted-bg iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* DESSUS : ORIGINAL */
        .layer-original-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 50%;
            height: 100%;
            z-index: 2;
            overflow: hidden;
            border-right: 5px solid var(--blue-dys);
            box-shadow: 10px 0 15px rgba(0, 0, 0, 0.1);
        }

        .layer-original-overlay img {
            width: 100vw;
            /* Fixé à la largeur de l'écran */
            height: 100vh;
            object-fit: contain;
            /* Ou cover selon vos images */
            background: #fff;
        }

        /* BARRE DE MANIPULATION ÉLARGIE */
        .dys-handle {
            position: absolute;
            top: 0;
            left: 50%;
            bottom: 0;
            width: 60px;
            /* Zone de clic plus large */
            margin-left: -30px;
            z-index: 10;
            cursor: ew-resize;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: none;
            /* Crucial pour mobile */
        }

        .handle-line {
            width: 2px;
            height: 100%;
            background: rgba(255, 255, 255, 0.5);
        }

        .dys-handle-circle {
            position: absolute;
            width: 50px;
            height: 50px;
            background: var(--blue-dys);
            border: 4px solid white;
            border-radius: 50%;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            font-size: 24px;
        }

        /* BLOQUEUR D'IFRAME (Empêche l'iframe de voler le focus pendant le drag) */
        .drag-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9;
            display: none;
            /* Activé uniquement pendant le drag */
        }

        .dys-label {
            position: absolute;
            top: 30px;
            padding: 10px 20px;
            color: white;
            font-weight: bold;
            border-radius: 30px;
            z-index: 5;
            pointer-events: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .label-orig {
            left: 30px;
            background: rgba(0, 0, 0, 0.7);
        }

        .label-adapt {
            right: 30px;
            background: var(--blue-dys);
        }
    </style>
</head>

<body>

    <div class="dys-full-page-widget" id="dysWidget">
        <div class="drag-overlay" id="dragOverlay"></div>

        <div class="layer-adapted-bg">
            <iframe src="example/example_exercice.html"></iframe>
            <span class="dys-label label-adapt">Après : Version Adaptée</span>
        </div>

        <div class="layer-original-overlay" id="overlayLayer">
            <img src="example/math_pdf.png" id="originalImg" alt="Original">
            <span class="dys-label label-orig">Avant : Document Original</span>
        </div>

        <div class="dys-handle" id="handle">
            <div class="handle-line"></div>
            <div class="dys-handle-circle">↔</div>
        </div>
    </div>

    <script>
        const widget = document.getElementById('dysWidget');
        const overlay = document.getElementById('overlayLayer');
        const handle = document.getElementById('handle');
        const img = document.getElementById('originalImg');
        const dragOverlay = document.getElementById('dragOverlay');

        function syncSize() {
            img.style.width = window.innerWidth + 'px';
            img.style.height = window.innerHeight + 'px';
        }
        window.addEventListener('resize', syncSize);
        syncSize();

        let isDragging = false;

        function move(e) {
            if (!isDragging) return;

            const rect = widget.getBoundingClientRect();
            let x = (e.pageX || (e.touches ? e.touches[0].pageX : 0)) - rect.left;

            if (x < 0) x = 0;
            if (x > rect.width) x = rect.width;

            const pct = (x / rect.width) * 100;
            overlay.style.width = pct + '%';
            handle.style.left = pct + '%';
        }

        // Amélioration de la capture des événements
        const startDrag = (e) => {
            isDragging = true;
            dragOverlay.style.display = 'block'; // On bloque l'iframe
        };

        const stopDrag = () => {
            isDragging = false;
            dragOverlay.style.display = 'none'; // On libère l'iframe
        };

        handle.addEventListener('mousedown', startDrag);
        window.addEventListener('mouseup', stopDrag);
        window.addEventListener('mousemove', move);

        handle.addEventListener('touchstart', startDrag);
        window.addEventListener('touchend', stopDrag);
        window.addEventListener('touchmove', move);
    </script>
</body>

</html>